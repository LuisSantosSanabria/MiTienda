@* @using MiTienda.Utilities;

@{
    int CarritoCount = 0;
    if(Context.Session.Get<List<CarritoVm>>("Carrito") != null)
    {
        var carrito = Context.Session.Get<List<CarritoVm>>("Carrito");
        CarritoCount = carrito.Count();
    }

    <li class="nav-item ms-auto">
    <a class="btn btn-outline-dark" href="/Home/ViewCarrito">
         <i class="fa-solid fa-cart-shopping"></i>
         Carrito
         <span class="badge bg-dark text-white ms-1 rounded-pill">@CarritoCount</span>
    </a>
    </li>
} *@

@using System.Security.Claims
@using MiTienda.Utilities

@{
    int carritoCount = 0;

    if (Context.User.Identity!.IsAuthenticated)
    {
        // Obtener el ID del usuario autenticado
        var userId = Context.User.FindFirstValue(ClaimTypes.NameIdentifier);
        var sessionKey = $"Carrito_{userId}";

        // Obtener el carrito específico del usuario
        var carrito = Context.Session.Get<List<CarritoVm>>(sessionKey);

        if (carrito != null)
        {
            // Sumar la cantidad total de productos
            carritoCount = carrito.Sum(x => x.Cantidad);
        }
    }
}

<li class="nav-item ms-auto">
    <a class="btn btn-outline-dark position-relative" href="/Home/ViewCarrito">
        <i class="fa-solid fa-cart-shopping"></i>
        Carrito
        <span class="badge bg-dark text-white ms-1 rounded-pill">@carritoCount</span>
    </a>
</li>
